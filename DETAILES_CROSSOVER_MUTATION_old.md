### 1. 交叉 (crossover) ― **遺伝情報の「再配列」**

実装では *1 点交叉*（`one_point`）を採用しています。
遺伝子が実数ベクトル **g = (x₀, x₁, …, x\_{d−1})** であるとき：

| 手順             | 数式・処理                                                                                                  | 直感的イメージ              |
| -------------- | ------------------------------------------------------------------------------------------------------ | -------------------- |
| **① カット位置を決定** | `cut = rng.integers(1, d-1)`                                                                           | 2 本の親鎖をハサミで切る位置を決める  |
| **② 子を生成**     | `python\nchild1 = concat(parent1[:cut], parent2[cut:])\nchild2 = concat(parent2[:cut], parent1[cut:])` | 前半は親1，後半は親2（その逆も同様）  |
| **③ コピーを返す**   | NumPy `copy()` で独立メモリ確保                                                                                | 親の遺伝子が後で変わっても子に影響しない |

> **一次元の特例**
> もし `d = 1` なら“交叉点”が存在しないので **「親をそのまま複製」** (`_noop_crossover`)。
> これで一次元問題でも例外が出ずロバストに動きます。

---

### 2. 変異 (mutation) ― **ランダム微小ノイズによる探索**

実装は **ガウス変異**（`gaussian`）。各遺伝子に対し

$$
x_i \;\to\; x_i' \;=\; x_i + \Delta,\qquad 
\Delta \sim \mathcal{N}(0,\; \sigma^2)
$$

を **確率 `prob`** で適用します。アルゴリズム的には：

```python
mask = rng.random(size=x.shape) < prob      # True の位置だけ変異
noise = rng.normal(0.0, sigma, size=mask.sum())
child[mask] += noise
child = clip(child, bounds)                 # 物理的に不当な値を抑制
```

* **σ (sigma)** : 探索スケール。大きいほど跳躍が大きくなる（粗探索）。
* **prob** : *per-gene* 変異確率。`prob=1.0` なら全遺伝子に毎回ノイズが入る。
* **clip** : `bounds` を超えたら `np.clip()` で物理的に妥当な範囲へ戻す。
  例：レーザーパワーの位相なら \[0, 2π)、座標なら \[xmin, xmax] 等。

---

### 3. 1 世代更新 (`_next_generation`) の詳細フロー

```text
elite ← best(pop)                  # 0. エリート保持
new_genes[0] ← elite

while i < pop_size:                # ➊ 親選択 (tournament k)
    p1, p2 ← tournament_select()
    if rand < crossover_rate:      # ➋ 交叉
        c1, c2 ← crossover_op(p1, p2)
    else:
        c1, c2 ← p1.copy(), p2.copy()

    c1 ← mutation_op(c1)           # ➌ 変異
    c2 ← mutation_op(c2)

    new_genes[i]     ← c1          # ➍ 子を格納
    new_genes[i + 1] ← c2
    i += 2

population ← new_genes             # ➎ 世代交替
fitness    ← evaluate(population)

# ➏ エリート保険 — 万一消えたら最悪個体と入替
```

| 番号           | 処理                               | 数理・実装のポイント                                      |
| ------------ | -------------------------------- | ----------------------------------------------- |
| **0 エリート保持** | 「最良個体は必ず残る」ことで収束が単調非増大（最小化なら非増加） | `elite_gene` を `new_genes[0]` へコピー              |
| **➊ 親選択**    | トーナメント選択：乱択 k 個の中で最良を親に          | k を大きくすると探索圧が強くなる                               |
| **➋ 交叉**     | `rand < crossover_rate` で採用      | 実数ベクトルの再配列で大域探索                                 |
| **➌ 変異**     | 局所探索役：個体を微小に「揺らす」                | `mutation_sigma` を世代と共に小さくすると最適化 annealing-like |
| **➍ 子の格納**   | 2 個体ずつ埋める → 行列書き換えが連続メモリで速い      |                                                 |
| **➎ 評価**     | `np.apply_along_axis` で一括        | Python ループを回さず NumPy に委譲                        |
| **➏ エリート保険** | 理論上 0 行目はエリートだが、安全のため最悪個体と比較     | 数値誤差や clip による事故を防止                             |

---

### 4. パラメータ調整の実践的ヒント

| パラメータ              | 効果          | 典型値                                     |
| ------------------ | ----------- | --------------------------------------- |
| `crossover_rate`   | 大域探索の“跳躍”頻度 | 実数 GA なら 0.7–0.95                       |
| `mutation_prob`    | 微細探索の粒度     | 1/dim 〜 0.2                             |
| `mutation_sigma`   | ノイズ強度       | 最初 0.1×(変数幅) → 徐々に減衰                    |
| `tournament_k`     | 選択圧の強さ      | 2–5（大きいと早く収束・多様性↓）                      |
| `patience` + `tol` | 早期停止        | `tol` ≈ 1e-5 × 目標量, `patience` = 10–100 |

---

### 5. 世代ログの読み方（実行例）

```
[gen    0] best = 9.9e-03   ← 初期 0 世代。結構遠い
[gen   10] best = 3.0e-05   ← 急速に収束（選択圧 + crossover）
・・・
[gen  110] best = 3.0e-05   ← tol 未満改善が続く
No significant improvement; stopping early.
```

* **平坦になる箇所**：mutation だけでは谷底へ入れない or σ が小さすぎ
  → `mutation_sigma` を上げる / `crossover_rate` を高める
* **早期停止**：`patience` 世代連続で改善幅 < `tol` のため打ち切り
  → `patience` を増やす or `tol` を小さくすると更に追い込む

---

### 6. 物理・化学計算での実践例

1. **ポテンシャル表面での極小探索**

   * 遺伝子＝(x, y, z) 原子座標
   * `bounds` を真空箱サイズに設定
2. **スペクトルフィッティング**

   * 遺伝子＝ピーク位置・幅・振幅のセット
   * 交叉でパラメータを混ぜ、ガウス変異で幅や振幅を微調整
3. **波形整形最適化**

   * 遺伝子＝位相マスクの離散点列
   * `mutation` を位相ラップ付きで書き換え、`clip()` を \[0, 2π) へ

---

### まとめ

交叉は **探索空間を大きくジャンプ** し、変異は **局所的な微修正** を加える ―
両者のバランスが GA の心臓部です。今回の実装は

* **演算子が差し替え自由**（Strategy パターン）
* **一次元でも多次元でもエラー無し**（noop crossover）
* **早期停止で計算資源を節約**

という設計で、研究用途の“パラメータ探索”や“関数最小化”にそのまま使えます。
パラメータを意識的にチューニングし、ログを読み解きながら **探索 vs 収束** のトレードオフを体感してみてください。
